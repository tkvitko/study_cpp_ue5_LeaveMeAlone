// LeaveMeAlone Game by Netologiya. All Rights Reserved.

#pragma once

#include "CoreMinimal.h"
#include "Components/ActorComponent.h"
#include "LMAWeaponComponent.generated.h"

class ALMABaseWeapon;
class UAnimMontage;


UCLASS( ClassGroup=(Custom), meta=(BlueprintSpawnableComponent) )
class LEAVEMEALONE_API ULMAWeaponComponent : public UActorComponent
{
	GENERATED_BODY()

public:
	ULMAWeaponComponent();
    void Fire();
    void Reload();

protected:
    UPROPERTY(EditDefaultsOnly, Category="Weapon")
    TSubclassOf<ALMABaseWeapon> WeaponClass;
    
    UPROPERTY(EditDefaultsOnly, Category="Weapon")
    UAnimMontage* ReloadMontage;
    
	virtual void BeginPlay() override;
    
private:
    UPROPERTY()
    ALMABaseWeapon* Weapon = nullptr;
    
    bool AnimReloading = false;
    
    void SpawnWeapon();
    
    void InitAnimNotify();
    void OnNotifyReloadFinished(USkeletalMeshComponent* SkeletalMesh);
    bool CanReload() const;

public:
	virtual void TickComponent(float DeltaTime, ELevelTick TickType, FActorComponentTickFunction* ThisTickFunction) override;
    
    UFUNCTION(BlueprintCallable)
    int GetCurrentBullets() const;
//    bool GetCurrentWeaponAmmo(FAmmoWeapon& AmmoWeapon) const;
};
